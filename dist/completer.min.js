/*!
 * Completer v0.0.3
 * https://github.com/fengyuanchen/completer
 *
 * Copyright 2014 Fengyuan Chen
 * Released under the MIT license
 */

!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";var b=a(document),c=function(b,d){d=a.isPlainObject(d)?d:{},this.$element=a(b),this.defaults=a.extend({},c.defaults,this.$element.data(),d),this.init()};c.prototype={construstor:c,init:function(){var b=c.fn.toArray(this.defaults.source);b.length>0&&(this.data=b,this.$completer=a(this.defaults.template),this.$completer.hide().appendTo("body"),this.place(),this.$element.on({focus:a.proxy(this.enable,this),blur:a.proxy(this.disable,this)}),this.$element.is(":focus")&&this.enable())},enable:function(){this.active||(this.active=!0,this.$element.on({keydown:a.proxy(this.keydown,this),keyup:a.proxy(this.keyup,this)}),this.$completer.on({mousedown:a.proxy(this.mousedown,this),mouseover:a.proxy(this.mouseover,this)}))},disable:function(){this.active&&(this.active=!1,this.$element.off({keydown:this.keydown,keyup:this.keyup}),this.$completer.off({mousedown:this.mousedown,mouseover:this.mouseover}))},attach:function(b){var c,d,e=this.defaults.separator,f=e?b.indexOf(e):-1,g=[],h="",i=this;-1!==f&&(h=b.substring(f),b=b.replace(h,""),c=new RegExp("^"+h,"img")),a.each(this.data,function(a,f){f=e+f,d=i.template(b+f),c&&c.test(f)?g.unshift(d):g.push(d)}),this.fill(g.join(""))},suggest:function(b){var c=this,d=[];a.each(this.data,function(a,e){-1!==e.indexOf(b)&&d.push(c.template(e))}),this.fill(d.join(""))},template:function(a){var b=this.defaults.itemTag;return"<"+b+">"+a+"</"+b+">"},fill:function(a){a&&(this.$completer.empty().html(a),this.$completer.children(":first").addClass(this.defaults.selectedClass),this.show())},complete:function(){var a=this.defaults,b=a.filter(this.$element.val());return""===b?void this.hide():void(a.suggest?this.suggest(b):this.attach(b))},keydown:function(a){13===a.keyCode&&(a.stopPropagation(),a.preventDefault())},keyup:function(a){var b=a.keyCode;13===b||38===b||40===b?this.toggle(b):this.complete()},mouseover:function(b){var c=this.defaults,d=c.selectedClass,e=a(b.target);e.is(c.itemTag)&&e.addClass(d).siblings().removeClass(d)},mousedown:function(b){b.stopPropagation(),b.preventDefault(),this.setValue(a(b.target).text())},setValue:function(a){this.$element.val(a),this.defaults.complete(),this.hide()},toggle:function(a){var b=this.defaults.selectedClass,c=this.$completer.find("."+b);switch(a){case 40:c.removeClass(b),c=c.next();break;case 38:c.removeClass(b),c=c.prev();break;case 13:this.setValue(c.text())}0===c.length&&(c=this.$completer.children(40===a?":first":":last")),c.addClass(b)},place:function(){var a=this.$element,b=a.offset(),c=b.left,d=b.top,e=a.outerHeight(),f=a.outerWidth();"right"===this.defaults.position?c+=f:d+=e,this.$completer.css({left:c,minWidth:f,top:d,zIndex:this.defaults.zIndex})},show:function(){this.$completer.show(),b.on("mousedown",a.proxy(this.hide,this))},hide:function(){this.$completer.hide(),b.off("mousedown",this.hide)}},c.fn={toArray:function(b){return"string"==typeof b&&(b=b.replace(/[\{\}\[\]"']+/g,"").split(/[\,\|\/]+/),b=a.map(b,function(b){return a.trim(b)})),b}},c.defaults={complete:function(){},itemTag:"li",filter:function(a){return a},position:"bottom",source:[],selectedClass:"completer-selected",separator:"",suggest:!1,template:'<ul class="completer-container"></ul>',zIndex:1},c.setDefaults=function(b){a.extend(c.defaults,b)},a.fn.completer=function(b){return this.each(function(){a(this).data("completer",new c(this,b))})},a.fn.completer.Constructor=c,a.fn.completer.setDefaults=c.setDefaults,a(function(){a("[completer]").completer()})});